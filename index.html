<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>MagicBlock Duel</title>
<style>
  body {
    font-family: 'Arial', sans-serif;
    background: #0b0b0f;
    color: #fff;
    margin: 0;
    padding: 0;
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  h1, h2 {
    text-shadow: 0 0 10px #a259ff, 0 0 20px #a259ff;
  }
  #menu, #game, #result {
    display: none;
    text-align: center;
    margin-top: 50px;
  }
  #menu button, #result button, #reactionBtn {
    padding: 15px 30px;
    font-size: 22px;
    font-weight: bold;
    color: #fff;
    background: linear-gradient(45deg, #a259ff, #ff3ecf);
    border: none;
    border-radius: 12px;
    cursor: pointer;
    text-shadow: 0 0 5px #fff;
    transition: all 0.3s ease;
    box-shadow: 0 0 20px #a259ff;
  }
  #menu button:hover, #result button:hover, #reactionBtn:hover {
    transform: scale(1.05);
    box-shadow: 0 0 30px #ff3ecf;
  }
  #duel {
    display: flex;
    justify-content: center;
    align-items: center;
    gap: 150px;
    margin-top: 50px;
  }
  .player, .ai {
    display: flex;
    flex-direction: column;
    align-items: center;
  }
  .score {
    font-size: 24px;
    margin-top: 20px;
    text-shadow: 0 0 10px #a259ff;
  }
  #reactionBtn {
    margin-top: 50px;
    width: 150px;
    height: 150px;
    border-radius: 50%;
    background: gray;
  }
  #result img {
    width: 150px;
    margin-top: 20px;
  }
</style>
</head>
<body>

<div id="menu">
  <h1>MagicBlock Duel</h1>
  <button id="startBtn">Start Game</button>
</div>

<div id="game">
  <h2 id="countdown">3</h2>
  <div id="duel">
    <div class="player">
      <img src="images/player.png" alt="Player" width="120">
      <div>YOU</div>
    </div>
    <div class="ai">
      <img src="images/ganster.png" alt="AI" width="120">
      <div>Wizardio</div>
    </div>
  </div>
  <button id="reactionBtn"></button>
  <div class="score" id="score">Player: 0 | AI: 0</div>
</div>

<div id="result">
  <h2 id="resultText"></h2>
  <img id="winnerImg" src="" alt="Winner">
  <button id="restartBtn">Restart Game</button>
</div>

<script>
const menu = document.getElementById('menu');
const game = document.getElementById('game');
const result = document.getElementById('result');
const startBtn = document.getElementById('startBtn');
const restartBtn = document.getElementById('restartBtn');

const countdownEl = document.getElementById('countdown');
const reactionBtn = document.getElementById('reactionBtn');
const scoreEl = document.getElementById('score');
const resultText = document.getElementById('resultText');
const winnerImg = document.getElementById('winnerImg');

let playerScore = 0;
let aiScore = 0;
let round = 1;
let lampOn = false;
let aiTimeout;

function showMenu() {
  menu.style.display = 'block';
  game.style.display = 'none';
  result.style.display = 'none';
}

function startGame() {
  menu.style.display = 'none';
  game.style.display = 'block';
  playerScore = 0;
  aiScore = 0;
  round = 1;
  scoreEl.textContent = `Player: ${playerScore} | AI: ${aiScore}`;
  startRound();
}

function startRound() {
  countdownEl.textContent = '3';
  lampOn = false;
  reactionBtn.style.background = 'gray';

  let count = 3;
  const countdownInterval = setInterval(() => {
    count--;
    if (count > 0) {
      countdownEl.textContent = count;
    } else {
      clearInterval(countdownInterval);
      countdownEl.textContent = '';
      setTimeout(turnLampOn, Math.random() * 2000 + 1000); // лампочка загорается через 1-3 секунды
    }
  }, 1000);
}

function turnLampOn() {
  lampOn = true;
  reactionBtn.style.background = 'green';

  const aiReactionTime = 250; // мс
  aiTimeout = setTimeout(() => {
    if (lampOn) {
      aiScore++;
      reactionBtn.style.background = 'gray';
      lampOn = false;
      endRound('AI');
    }
  }, aiReactionTime);
}

reactionBtn.addEventListener('click', () => {
  if (lampOn) {
    playerScore++;
    reactionBtn.style.background = 'gray';
    lampOn = false;
    clearTimeout(aiTimeout);
    endRound('Player');
  }
});

function endRound(winner) {
  scoreEl.textContent = `Player: ${playerScore} | AI: ${aiScore}`;

  if (playerScore === 2 || aiScore === 2 || round === 3) {
    setTimeout(showResult, 800);
  } else {
    round++;
    setTimeout(startRound, 1000);
  }
}

function showResult() {
  game.style.display = 'none';
  result.style.display = 'block';
  if (playerScore > aiScore) {
    resultText.textContent = 'You won!';
    winnerImg.src = 'images/player.png';
  } else {
    resultText.textContent = 'You lose!';
    winnerImg.src = 'images/ganster.png';
  }
}

startBtn.addEventListener('click', startGame);
restartBtn.addEventListener('click', showMenu);

showMenu();
</script>

</body>
</html>
